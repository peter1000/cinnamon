# Description: Linux desktop which provides advanced innovative features and a traditional user experience.
# URL: http://cinnamon.linuxmint.com/
# Maintainer: https://github.com/linuxmint
# Packager: fanch at orange do fr thierryn1 at hispeed dot ch
# Depends on: ca-certificates accountsservice cinnamon-settings-daemon cinnamon-session cinnamon-translations cjs gconf gstreamer libgnome-keyring librsvg networkmanager muffin python-cairo python-lxml webkit cinnamon-control-center cinnamon-screensaver cinnamon-menus libgnomekbd polkit-gnome

# Need to cleanup to make shure the sources are not reused as they are all names almost the same
PKGMK_KEEP_SOURCES="no"


name=cinnamon
version=2.6.13
release=1
source=(https://github.com/linuxmint/$name/archive/$version.tar.gz
	set_wheel.patch
        gnome-3.14.patch
        default-theme.patch)

build() {
	cd Cinnamon-$version

  # Use wheel group instread of sudo
  patch -Np1 -i ../set_wheel.patch

  # Some fixes for GNOME 3.14
  patch -Np1 -i ../gnome-3.14.patch

  # Set default theme to 'cinnamon'
  patch -Np1 -i ../default-theme.patch

  # Add polkit agent to required components
  sed -i 's/RequiredComponents=\(.*\)$/RequiredComponents=\1polkit-gnome-authentication-agent-1;/' \
    files/usr/share/cinnamon-session/sessions/cinnamon*.session

  # Fix for the python2 PAM module  
  sed -i 's:import PAM:import pam:' files/usr/lib/cinnamon-settings/modules/cs_user.py

  # Use pkexec instead of gksu
  sed -i 's/gksu/pkexec/' files/usr/bin/cinnamon-settings-users

  # Check for the cc-panel path, not for the unneeded binary
  sed -i 's|/usr/bin/cinnamon-control-center|/usr/lib/cinnamon-control-center-1/panels|' \
    files/usr/bin/cinnamon-settings

  # Cinnamon has no upstream backgrounds, use GNOME backgrounds instead
  sed -i 's|/usr/share/cinnamon-background-properties|/usr/share/gnome-background-properties|' \
    files/usr/lib/cinnamon-settings/modules/cs_backgrounds.py

  # Fix selected background color in Cinnamon Settings for Adwaita theme
  sed -i 's/@selected_bg_color;/@theme_selected_bg_color;/' \
    files/usr/lib/cinnamon-settings/cinnamon-settings.py
    
      ./autogen.sh --prefix=/usr \
	--with-ca-certificates=/etc/ssl \
               --sysconfdir=/etc \
               --libexecdir=/usr/lib/cinnamon \
               --localstatedir=/var \
               --disable-static \
               --disable-schemas-compile \
               --enable-compile-warnings=yes
    make 
	
    make DESTDIR=$PKG install
}
